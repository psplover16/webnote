import{r as i,x as _,y as $,f as F,o as w,c as f,a as r,p as P,j as T,F as A,b as R,t as B,n as O,g as S,u as k,d as V}from"./index-tug10zDy.js";const j=""+new URL("background-o-lekZSaI4.jpg",import.meta.url).href,L=""+new URL("scratch-off-0ZSFEQFi.jpg",import.meta.url).href,U=["width","height"],z={__name:"scratchCard",props:{width:{type:Number,default:300},height:{type:Number,default:200},rewardItem:{type:String,default:"red"},scratchItem:{type:String,default:"silver"},maxArea:{type:Number,default:.8},drawCircleRadius:{type:Number,default:20}},emits:["getReward"],setup(n,{emit:o}){const c=n,a=i(null),t=_(()=>a.value.getContext("2d")),d=i(!1),p=i(0),l=i(),v=_(()=>Math.max(a.value.width/l.value.width,a.value.height/l.value.height)),m=i(!1),M=o,y=e=>{l.value=new Image;const s=new URL(e,import.meta.url).href;l.value.src=s,l.value.onload=function(){const u=l.value.width*v.value,h=l.value.height*v.value;t.value.globalCompositeOperation="copy",t.value.drawImage(l.value,0,0,u,h),m.value=!1}},I=async e=>{if(!d.value)return;const s=a.value.getBoundingClientRect();let u,h;e.touches?(u=e.touches[0].clientX-s.left,h=e.touches[0].clientY-s.top):(u=e.clientX-s.left,h=e.clientY-s.top),t.value.globalCompositeOperation="destination-out",t.value.beginPath(),t.value.arc(u,h,c.drawCircleRadius,0,Math.PI*2),t.value.fill();const x=t.value.getImageData(0,0,a.value.width,a.value.height).data;p.value=0;for(let b=0;b<x.length;b+=4)x[b+3]===0&&p.value++;p.value/(a.value.width*a.value.height)>=c.maxArea&&(m.value||(await N(),M("getReward"),m.value=!0))},C=e=>{d.value=!0,I(e)},g=()=>{d.value=!1},N=async()=>new Promise(e=>{t.value.clearRect(0,0,a.value.width,a.value.height),e()}),D=()=>{const e=l.value.width*v.value,s=l.value.height*v.value;t.value.globalCompositeOperation="copy",t.value.drawImage(l.value,0,0,e,s),m.value=!1};return $(()=>c.scratchItem,e=>{y(e)}),F(()=>{console.log("onMounted"),y(c.scratchItem)}),(e,s)=>(w(),f(A,null,[r("div",{class:"relative bg-no-repeat bg-contain bg-center inline-block",style:T({width:`${n.width}px`,height:`${n.height}px`,backgroundImage:`url(${n.rewardItem})`})},[r("canvas",{ref_key:"scratchCanvas",ref:a,width:n.width,height:n.height,onMousedown:C,onMousemove:I,onMouseup:g,onMouseout:g,onTouchstart:C,onTouchmove:P(I,["prevent"]),onTouchend:g,onTouchcancel:g},null,40,U)],4),r("button",{class:"border border-black",onClick:D},"重置")],64))}},E={key:0,type:"I"},G={class:"text-center"},H={__name:"ch1",props:{title:String},setup(n){const o=i(!1),c=()=>{alert("中獎囉")};return(a,t)=>(w(),f("div",null,[r("h2",{onClick:t[0]||(t[0]=d=>o.value=!o.value)},[R(B(n.title)+" ",1),r("div",{class:O(["isShow",o.value?"":"rotate180"])},"^",2)]),o.value?(w(),f("ol",E,[r("li",null,[R(" scratchCard.vue "),r("div",G,[S(z,{rewardItem:k(j),scratchItem:k(L),maxArea:.2,drawCircleRadius:20,onGetReward:c},null,8,["rewardItem","scratchItem"])])])])):V("",!0)]))}},Y={__name:"canvasPage",setup(n){return(o,c)=>(w(),f("div",null,[S(H,{title:"刮刮樂"})]))}};export{Y as default};
